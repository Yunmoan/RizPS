# Riz PS

è¿™æ˜¯å¯¹äº Rizlineï¼ˆå¾‹åŠ¨è½¨è¿¹ï¼‰æ¸¸æˆæ¸¯æ¾³å°ç‰ˆæœ¬çš„æœåŠ¡ç«¯é‡å®ç°ï¼Œä¸è£…äº†æ‘Šç‰Œäº†ï¼Œä»åå­—å°±èƒ½çœ‹å‡ºæ¥ï¼ŒPS = Private Serverï¼Œè¿™å…¶å®å°±æ˜¯ä¸ªå¾‹åŠ¨è½¨è¿¹çš„ç§æœ

## å¼€å‘è®¡åˆ’

- [x] å®Œæ•´æ¨¡æ‹Ÿé›·éœ†SDK
- [x] è´¦å·ç™»é™†å¹¶å»é™¤åŒºåŸŸã€æ‰‹æœºå¡é™åˆ¶
- [x] æ­£å¸¸å­˜æ¡£/åŠ è½½æ­Œæ›²
- [x] æ¸¸æˆå†…æ›´æ–°ã€æ­Œæ›²ä¸‹è½½ï¼ˆå› ä¸ºå‘ç°å¯ä»¥ç›´æ¥ç›´è¿ä¸‹è½½ï¼Œæ‰€ä»¥resourcesåŠŸèƒ½ä¸ç”¨åšäº†ï¼‰
- [ ] å†…è´­å…¨è§£é”ï¼ˆiOS æ— ç¼˜ï¼‰

## å·²çŸ¥é—®é¢˜
1. å®‰å“è®¾å¤‡ä¸ŠGoogle Playç‰ˆæœ¬ä¼¼ä¹æ— æ³•æ­£å¸¸ç™»é™†ï¼ˆç”¨æˆ·åé¦ˆï¼‰
2. æ¸¸æˆå†…èµ„æºä¸‹è½½è¾ƒæ…¢ï¼Œä¸»è¦ä½“ç°åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ¸¸æˆã€ä¸‹è½½æ­Œæ›²å’Œè¿›å…¥æ­Œæ›²æ—¶ï¼ˆä¸»è¦æµé‡è¦ç»è¿‡ç”µè„‘å†åˆ°æ‰‹æœºï¼Œè¿˜è¦åœ¨mitmproxyé‚£é‡Œå¡ä¼šå„¿ï¼Œä½†ä¹Ÿä¸ä¼šæ…¢å¤šå°‘ï¼‰

## ç»è¿‡æµ‹è¯•çš„è®¾å¤‡
- [x] iPhone X (iOS16 + AppStoreå°æœRizline1.0.1)
- [x] Mumuå®‰å“æ¨¡æ‹Ÿå™¨ (Android12 + GooglePlay HKç‰ˆRizline1.0.2)

## å¦‚ä½•ä½¿ç”¨

### å…‹éš†ä»“åº“å¹¶è¡¥å…¨ä¾èµ–åŠè®¾ç½®proxy

Riz PS çš„è¿è¡Œä¾èµ–äº npmã€nodeã€python3 ä»¥åŠ python3 çš„åº“ mitmproxyï¼ˆå¯ä»¥ç›´æ¥é€šè¿‡ pip å®‰è£…ï¼‰ï¼Œè¯·å…ˆå®‰è£…å¥½è¿™äº›ä¸œè¥¿å¹¶é…ç½®å¥½ç¯å¢ƒå˜é‡

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å…‹éš†ä»“åº“ï¼š

```shell
git clone https://github.com/Searchstars/RizPS
```

cd åˆ°å…‹éš†å‡ºæ–‡ä»¶å¤¹é‡Œï¼Œç„¶åç”¨ä»¥ä¸‹å‘½ä»¤è¡¥å…¨ node_modulesï¼š

```shell
npm install
```

æœ€åæ‰“å¼€`proxy_config.py`ï¼Œå°†é‡Œé¢çš„REMOTE_HOSTæ”¹ä¸ºå¯¹äºæ‰‹æœºæ¥è¯´ä½ ç”µè„‘çš„ip

### åœ¨ä½ çš„è®¾å¤‡ä¸Šä¿¡ä»» mitmproxy è¯ä¹¦

è¿è¡Œè¿™æ¡å‘½ä»¤ï¼Œå¹¶ä¸”ä¿æŒå¼€å¯ä¸è¦å…³é—­:

```shell
mitmdump -s proxy.py -k --set block_global=false
```

ç¡®ä¿ä½ æ‰‹æœºè·Ÿç”µè„‘åœ¨åŒä¸€å±€åŸŸç½‘ä¸‹ï¼Œåœ¨æ‰‹æœºä¸Šå°† WiFi ä»£ç†è®¾ç½®ä¸º [ç”µè„‘IP:8080]ï¼ˆä¸‹è½½å¥½è¯ä¹¦ä¹‹åè¯·æ¢å¤åŸæ¥çš„è®¾ç½®ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ— æ³•è”ç½‘ï¼‰ï¼Œä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ mitm.it

ä¸å‡ºæ„å¤–çš„è¯åº”è¯¥èƒ½çœ‹åˆ°å‡ ä¸ªç³»ç»Ÿçš„å›¾æ ‡ï¼Œè‹¥æ˜¾ç¤º "If you can see this, traffic is not passing through mitmproxy."ï¼Œè¯·æ£€æŸ¥ä½ çš„ä»£ç†è®¾ç½®æ˜¯å¦æ­£ç¡®

#### Android

Android ç«¯çš„é…ç½®éœ€è¦è¿›è¡Œè¯ä¹¦æ ¼å¼è½¬æ¢ï¼Œæ•…è¯·äº‹å…ˆåœ¨ç”µè„‘ä¸Šå®‰è£… OpenSSL

åœ¨åˆšæ‰çš„ç½‘é¡µä¸­ç‚¹å‡» Android å³è¾¹çš„"Get mitmproxy-ca-cert.cer"å¹¶å°†ä¸‹è½½å¥½çš„ .cer æ ¼å¼è¯ä¹¦ä¼ åˆ°ç”µè„‘ä¸Š

è¿è¡Œè¿™æ¡å‘½ä»¤

```shell
openssl x509 -inform PEM -subject_hash_old -in mitmproxy-ca-cert.cer
```

è¾“å‡ºçš„ç¬¬ä¸€è¡ŒåŠ ä¸Š `.0` å°±æ˜¯ä½ çš„è¯ä¹¦åç§°ï¼Œæ¯”å¦‚è¾“å‡ºçš„æ˜¯ `c8750f0d`ï¼Œè¯ä¹¦å°±åº”è¯¥è¢«é‡å‘½åä¸º `c8750f0d.0`

ç”±äº Google çš„é™åˆ¶ï¼Œé«˜ç‰ˆæœ¬ Android æ— æ³•ç›´æ¥å®‰è£…å¯ä¾›ç³»ç»Ÿä¿¡ä»»çš„æ ¹è¯ä¹¦

è‹¥ /system åˆ†åŒºå¯å†™ï¼Œåœ¨è·å– Root æƒé™åå°†é‡å‘½åå¥½çš„è¯ä¹¦æ”¾å…¥ `/system/etc/security/cacerts` ç›®å½•ä¸‹é‡å¯æ‰‹æœºå³å¯

è‹¥ /system åˆ†åŒºåªè¯»ï¼Œåˆ™éœ€è¦é€šè¿‡ Magisk æ¨¡å—çš„æ–¹å¼å®‰è£…è¯ä¹¦ï¼Œåœ¨ http://mitm.it/cert/magisk å³å¯è·å–ç”¨äºå®‰è£…çš„ Magisk æ¨¡å—

åœ¨å®‰è£…å¥½è¯ä¹¦ä¹‹åï¼Œæ‰“å¼€æ‰‹æœºçš„ç³»ç»Ÿè®¾ç½®ï¼Œæ­¤æ—¶åº”è¯¥èƒ½åœ¨ å®‰å…¨ - æ›´å¤šå®‰å…¨è®¾ç½® - åŠ å¯†ä¸å‡­æ® - ä¿¡ä»»çš„å‡­æ®(ä¸åŒæ‰‹æœºå‚å•†å¯èƒ½ä½ç½®ä¸åŒ) ä¸­çš„ç³»ç»Ÿä¸€æ æ‰¾åˆ° mitmproxy çš„è¯ä¹¦

#### iOS

åœ¨åˆšæ‰çš„ç½‘é¡µä¸­ç‚¹å‡» iOS å³è¾¹çš„"Get mitmproxy-ca-cert.pem"ä¸‹è½½å¹¶è¿›è¡Œå®‰è£…

åœ¨è®¾ç½® > é€šç”¨ > å…³äºæœ¬æœº > è¯ä¹¦ä¿¡ä»»è®¾ç½® ä¸­æ‰¾åˆ°åˆšæ‰å®‰è£…çš„è¯ä¹¦ï¼Œå°†å…¶ä¿¡ä»»å³å¯

### å¯åŠ¨ node

```shell
node --tls-min-v1.2 index.js
```

éšåï¼Œä½ ä¾¿èƒ½çœ‹åˆ°æœåŠ¡å™¨è¾“å‡ºçš„æ—¥å¿—äº†ï¼ŒæœåŠ¡å™¨æˆåŠŸå¯åŠ¨äº†ï¼

### Enjoy

åœ¨ç¡®ä¿ mitmdump å’Œ node éƒ½æ­£å¸¸è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œåœ¨æ‰‹æœºä¸Šå°† WiFi ä»£ç†è®¾ç½®ä¸º [ç”µè„‘IP:8080]ï¼Œå¯åŠ¨Rizlineï¼ŒEnjoy itğŸ˜Šï¼

æ¸¸æˆå®‰è£…åç¬¬ä¸€æ¬¡å¯åŠ¨ä¼šä¸‹è½½èµ„æºæ–‡ä»¶ï¼Œå¯èƒ½éœ€è¦æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œè¶…è¿‡10åˆ†é’Ÿå†å½“ä½œé—®é¢˜æ¥åé¦ˆå“¦~

åœ¨æ‰“å¼€æ¸¸æˆåï¼Œè¯·ä¸€ç›´ä½¿ç”¨æ¸¸å®¢ç™»é™†ï¼Œå¿½è§†æ‰€æœ‰è®©ä½ ç»‘å®šè´¦å·æˆ–é‡è¯•è´¦å·ç™»é™†çš„æç¤ºï¼Œè‹¥å¼¹å‡ºè¯·é€‰æ‹©ä¸ç»§ç»­æ¸¸å®¢ç™»é™†ç›¸å…³çš„é€‰é¡¹

ç©å¤Ÿäº†è®°å¾—æŠŠæ‰‹æœºä¸Šçš„ä»£ç†è®¾ç½®æ¢å¤åŸçŠ¶ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ— æ³•æ­£å¸¸è”ç½‘

## æ¸¸æˆæŠ¥é”™è§£å†³

### æ³¨æ„ï¼šåœ¨é‡åˆ°ä»»ä½•é—®é¢˜æ—¶ï¼Œéƒ½è¯·å°†æ¸¸æˆå®Œå…¨å¸è½½ï¼ˆå®‰å“ç›´æ¥åˆ é™¤å³å¯ï¼ŒiOSè¯·æ ¹æ®ä»¥ä¸‹æ­¥éª¤åˆ é™¤ï¼š è®¾ç½® > é€šç”¨ > iPhoneå­˜å‚¨ç©ºé—´ > Rizline > çº¢è‰²çš„åˆ é™¤Appï¼‰åé‡æ–°å®‰è£…ï¼Œå¹¶ç¡®ä¿RizPSä¸ºæœ€æ–°ç‰ˆæœ¬ï¼ˆå»ºè®®æ¯æ¬¡ä½¿ç”¨å‰éƒ½git pullä¸€ä¸‹ï¼‰è‹¥é—®é¢˜ä»å­˜åœ¨ï¼Œå†æ ¹æ®ä¸‹æ–¹ç»™å‡ºçš„å»ºè®®è¿›è¡Œä¿®å¤

æ›´æ–°å¤±è´¥ï¼ˆ102ï¼‰

> è‡ªèº«ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥å°è¯•æ‰“å¼€æ¢¯å­

ç™»é™†å¤±è´¥ï¼ˆ200ï¼‰

> æ²¡è¿ä¸ŠRizPSï¼Œæ£€æŸ¥proxy_config.pyé‡Œçš„å†…å®¹æ˜¯å¦æ­£ç¡®

éªŒè¯å¤±è´¥ï¼ˆ2010ï¼‰

> æŠ¥é”™åŸç†æœªçŸ¥ï¼Œæœ¬äººä»…ä½¿ç”¨å®‰å“æ¨¡æ‹Ÿå™¨å¤ç°æˆåŠŸä¸€æ¬¡ï¼Œå®Œå…¨å¸è½½æ¸¸æˆå¹¶åˆ é™¤å…¨éƒ¨ç›¸å…³èµ„æºæ–‡ä»¶åé‡æ–°å®‰è£…è§£å†³

æ¸¸æˆåœ¨è½¬åœˆå°è¯•ç™»é™†åå´©æºƒ

> åŸç†æœªçŸ¥ï¼Œæ¦‚ç‡æ€§é—®é¢˜ï¼Œèƒ½å¤Ÿå¤šæ¬¡å¤ç°ï¼Œå®Œå…¨å¸è½½æ¸¸æˆå¹¶åˆ é™¤å…¨éƒ¨ç›¸å…³èµ„æºæ–‡ä»¶åé‡æ–°å®‰è£…è§£å†³

## ç–‘éš¾è§£ç­”

mitmdump è¾“å‡ºæ­£å¸¸ï¼Œnode æ²¡ååº”ï¼Œè¿› Rizline æ›´æ–°é”™è¯¯100ï¼Œç½‘ç»œé”™è¯¯10

> åœ¨å½“å‰ç‰ˆæœ¬ä¸­ï¼ŒRizPSå·²æ”¯æŒæ¸¸æˆå†…èµ„æºä¸‹è½½ï¼Œè¯·å°†RizPSæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè‹¥é—®é¢˜ä»å­˜åœ¨ï¼Œè¯·åœ¨å®‰è£…å®Œæˆåè¿›å…¥é¦–æ¬¡ Rizline æ—¶å…ˆä¸è¦åœ¨æ‰‹æœºä¸Šå¼€ HTTP ä»£ç†ï¼Œè£¸è¿ä¸‹è½½æ›´æ–°åï¼Œç™»é™†è´¦å·æ—¶ä¼šå¼¹å‡ºç½‘ç»œé”™è¯¯ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œé€€å‡ºæ¸¸æˆç„¶åå†æ‰“å¼€ HTTP ä»£ç†ï¼Œé‡å¼€ Rizline

æ— æ³•ä¸‹è½½æ­Œæ›²ï¼Œè¿›å…¥æ­Œæ›²ç‚¹å‡»å¼€å§‹ä¸€ç›´æœªä¸‹è½½å®Œæˆæˆ–å¡åŠ è½½

> ç›®å‰RizPSå·²æ”¯æŒç›´è¿å®˜æ–¹æœåŠ¡å™¨ä¸‹è½½å†…å®¹ï¼Œè¯·æ›´æ–°RizPSåå†è¯•ï¼Œè‹¥é—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œå¯ä»¥æ‰“å¼€æ¢¯å­è¯•è¯•

èƒ½ç”¨ Fiddler Classic ä»£æ›¿ mitmproxy å—ï¼Ÿ

> ä¸è¡Œï¼Œå› ä¸º fiddler.network.https> HTTPS handshake to 192.168.1.247 (for #96) failed. System.Security.Authentication.AuthenticationException è°ƒç”¨ SSPI å¤±è´¥ï¼Œè¯·å‚è§å†…éƒ¨å¼‚å¸¸ã€‚ < æ¥æ”¶åˆ°çš„æ¶ˆæ¯å¼‚å¸¸ï¼Œæˆ–æ ¼å¼ä¸æ­£ç¡®ã€‚Win32 (SChannel) Native Error Code: 0x8009032615

## ç¤¾åŒº
åŠ å…¥Discordï¼š[https://discord.gg/G64wHgqfUK](https://discord.gg/G64wHgqfUK)

## ç‰¹åˆ«æ„Ÿè°¢

ç‰¹åˆ«æ„Ÿè°¢å¼€æºé¡¹ç›® [Grasscutters/Grasscutter](https://github.com/Grasscutters/Grasscutter) æä¾›çš„ `proxy.py` åŠ `proxy_config.py`
